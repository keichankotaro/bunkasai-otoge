
# 究極のリズムゲームデバッガ - データシート

## 1. 概要

このデバッガは、Unityで開発中のリズムゲームのノーツ情報を、リアルタイムで外部のGUIアプリケーションに送信し、可視化するためのツールです。
UnityのC#スクリプトからUDPソケット通信でPythonのGUIアプリ（サーバー）へ情報を送信します。

- **Unityクライアント**: C# (DebugSocketClient.cs)
- **GUIサーバー**: Python (ultimate_debugger_ui.py) with Dear PyGui

## 2. セットアップ手順

### 2.1. Python GUIサーバーのセットアップ

1.  **Pythonのインストール:**
    まだインストールしていない場合は、Python 3.8以降をインストールしてください。

2.  **ライブラリのインストール:**
    プロジェクトのルートディレクトリ (`D:\keich\Unity\bunkasai-2023-otoge`) で、ターミナルまたはコマンドプロンプトを開き、以下のコマンドを実行して必要なライブラリをインストールします。

    ```bash
    pip install dearpygui
    ```

3.  **デバッガの起動:**
    同じターミナルで、以下のコマンドを実行してデバッガGUIを起動します。

    ```bash
    python Assets/ultimate_debugger_ui.py
    ```

    成功すると、「Ultimate Rhythm Game Debugger」というタイトルのウィンドウが表示されます。このウィンドウはUnityからのデータ受信を待機している状態です。

### 2.2. Unityクライアントのセットアップ

1.  **スクリプトの確認:**
    このドキュメントと同時に、以下のスクリプトがUnityプロジェクトの `Assets` フォルダに追加・変更されています。

    - `ultimate_debugger_ui.py` (新規追加)
    - `DebugSocketClient.cs` (新規追加)
    - `SpeedManager.cs` (変更)
    - `L1.cs` (変更)
    - `L2.cs` (変更)
    - `L3.cs` (変更)
    - `L4.cs` (変更)

2.  **Unityエディタの再起動:**
    Unityエディタを開いている場合は、一度閉じてから再度プロジェクトを開き、新しいスクリプトと変更を確実に認識させてください。

3.  **シーンへの組み込み:**
    `DebugSocketClient.cs` は、シングルトンとして設計されており、ゲームシーンが開始されると自動的にインスタンスが生成されます。特別な設定は不要です。

## 3. 使用方法

1.  **最初にPythonデバッガを起動します。**
    (上記「2.1. デバッガの起動」を参照)

2.  **次にUnityでゲームをプレイします。**

3.  ゲームが開始されると、Unityは自動的にローカルホスト(`127.0.0.1`)のポート`50051`にUDPパケットを送信し始めます。

4.  PythonデバッガのGUIに、以下のような情報がリアルタイムで表示されます。

    - **Status:** Unityとの接続状況（最初はDisconnected、データを受信するとConnectedになります）。
    - **Lane 1-4 パネル:** 各レーンで次に判定されるノーツのJSONデータが表示されます。データを受信するとパネルが短く点滅します。
    - **Speed Manager パネル:** `SpeedManager.cs`によって全体のノーツ速度が変更された際に、その詳細情報（イベントの種類、新しい速度など）が表示されます。
    - **Event Log:** 受信した全イベントのタイムスタンプ付きログが表示されます。

## 4. 通信データフォーマット

データは以下のJSON形式で送信されます。

```json
{
  "source": "(L1 | L2 | L3 | L4 | SpeedManager)",
  "payload": { ... } // 送信元によって異なるデータ
}
```

### ペイロードの例

- **送信元が `L1` の場合 (ノーツデータ):**
  ```json
  {
    "speed": "0.2",
    "time": 14.166666,
    "type": "tap"
  }
  ```

- **送信元が `SpeedManager` の場合 (速度変更データ):**
  ```json
  {
    "event": "time_trigger",
    "new_speed": 24.0,
    "trigger_time": 30.0,
    "multiplier": 2.0
  }
  ```

## 5. トラブルシューティング

- **デバッガに何も表示されない:**
    - PythonデバッガがUnityより先に起動していることを確認してください。
    - ファイアウォールがポート`50051`のUDP通信をブロックしていないか確認してください。

- **JSONに関するエラーが出る:**
    - C#側の送信ロジック、特にJSON文字列のフォーマットが正しいか確認してください。
